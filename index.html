<!DOCTYPE html>
<html lang="de">
<head>
	<meta charset="utf-8">
	<title>c-base Austrittsgenerator</title>


	<link rel="stylesheet" href="./css/foundation.min.css">

	<script type="text/javascript" src="./js/jquery-1.9.1.min.js"></script>
	<script type="text/javascript" src="./js/foundation.min.js"></script>
	<script type="text/javascript" src="./js/jspdf.js"></script>
	<script type="text/javascript" src="./js/libs/Deflate/adler32cs.js"></script>
	<script type="text/javascript" src="./js/libs/FileSaver.js/FileSaver.js"></script>
	<script type="text/javascript" src="./js/libs/Blob.js/BlobBuilder.js"></script>
	<script type="text/javascript" src="./js/jspdf.plugin.ie_below_9_shim.js"></script>
	<script type="text/javascript" src="./js/jspdf.plugin.split_text_to_size.js"></script>
	<script type="text/javascript" src="./js/jspdf.plugin.standard_fonts_metrics.js"></script>
	<script type="text/javascript" src="./js/mustache.js"></script>
	
</head>

<body>
	<div class="row" style="max-width:50em">
		<h1>c-base Austrittsgenerator</h1>
  <div class="small-12"><div class="panel">
  	<label>Identifizierungsmerkmale</label>
<div class="row">
      <div class="large-4 columns">
        <input type="text" placeholder="Name" id="name">
      </div>
      <div class="large-4 columns">
        <input type="text" placeholder="Nick" id="nick">
      </div>
      <div class="large-4 columns">
        <input type="text" placeholder="Member UID" id="memberid">
      </div>
      <div class="large-6 columns">
        <input type="text" placeholder="Straße + Hausnummer" id="street">
      </div>
      <div class="large-2 columns">
        <input type="text" placeholder="PLZ" id="postalcode">
      </div>
      <div class="large-4 columns">
        <input type="text" placeholder="Ort" id="city">
      </div>
    </div>

    <div class="row">
      <div class="large-12 columns">
        <label>Austrittsgrund (optional)</label>
        <textarea name="reason" cols="50" rows="10" id="reason"></textarea>
      </div>
    </div>

    <div class="row">
      <div class="large-12 columns">
        <label>Grußformel</label>
        <select id="valediction">
        	<option>Mit freundlichen Grüßen,</option>
        	<option>Mit unfreundlichen Grüßen,</option>
        	<option>Hochachtungsvoll,</option>
        	<option>Enttäuscht,</option>
        	<option>Genervt,</option>
        	<option>Voller Wut,</option>
        </select>
      </div>
    </div>
</div>

<a href="javascript:renderPDF()" class="button success">Download</a></div>
</div>

<script>

function renderPDF() {

	var today = new Date();
	var lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
	if (Math.round((lastDay - today)/1000/60/60/24)+1 < 15) {
		var lastDay = new Date(today.getFullYear(), today.getMonth() + 2, 0);
	}
	var name= $("#name").val()
	var nick = $("#nick").val()
	var memberid= $("#memberid").val()
	var street = $("#street").val()
	var postalcode = $("#postalcode").val()
	var city = $("#city").val()
	var reason= $("#reason").val()
	var valediction= $("#valediction option:selected").val()

	var view = {
	name: name,
	nick: nick,
	memberid: memberid,
	day: lastDay.getDate(),
	month: lastDay.getMonth()+1,
	year: lastDay.getFullYear(),
	reason: reason
};

	var letterdate = Mustache.render("{{city}}, den {{day}}.{{month}}.{{year}}", {city: city, day: today.getDate(), month: today.getMonth()+1, year: today.getFullYear()});
	var returnaddress = Mustache.render("{{name}} • {{street}} • {{postalcode}} {{city}}", {name: name, street: street, postalcode: postalcode, city: city});
	var text = Mustache.render("Sehr geehrter Vorstand,\n\nHiermit beende ich, {{name}} (Nick: {{nick}}, Mitgliedsnummer: {{memberid}}), meine Mitgliedschaft beim c-base e.V. zum {{day}}.{{month}}.{{year}}.\n{{diff}}\n{{reason}}", view);

	var doc = new jsPDF();

	doc.setFontSize(8);
	doc.text(27, 46, returnaddress);
	doc.line(20, 47, 100, 47);

	doc.setFontSize(12);

	doc.text(27,  53, "c-base e.V.");
	doc.text(27,  58, "z.Hd. Vorstand");
	doc.text(27,  63, "Rungestr. 20");
	doc.text(27,  68, "10179 Berlin");

	doc.setFontSize(12);
	doc.text(135, 100, letterdate);
	lines = doc.splitTextToSize(text, 170)
	doc.text(20, 120, lines)

	doc.text(20, 200, valediction);
	doc.setDrawColor(100,100,100);
	doc.line(20, 215, 80, 215);
	doc.text(20, 222, name)
	doc.output("datauri");
}
</script>
</body>
</html>
